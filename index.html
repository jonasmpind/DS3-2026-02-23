<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Design System Tokens</title>

<style>
body {
  font-family: system-ui;
  padding: 40px;
  background: #f5f6f8;
}

h1 { margin-bottom: 24px; }

.controls {
  display: flex;
  gap: 16px;
  margin-bottom: 32px;
}

input, select {
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #ddd;
  font-size: 14px;
}

.token {
  background: white;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
  border: 1px solid #e5e7eb;
}

.token-name {
  font-weight: 600;
  margin-bottom: 4px;
}

.token-meta {
  font-size: 12px;
  color: #666;
  margin-bottom: 8px;
}

.swatch {
  width: 32px;
  height: 32px;
  border-radius: 6px;
  border: 1px solid #ddd;
  margin-bottom: 8px;
}

.alias-chain {
  font-size: 12px;
  color: #888;
  margin-top: 6px;
  font-family: monospace;
}

.typography-preview {
  margin-top: 8px;
}
</style>
</head>

<body>

<h1>Design System Tokens</h1>

<div class="controls">
  <input type="text" id="search" placeholder="Search tokens..." />
  
  <select id="tierFilter">
    <option value="all">All tiers</option>
    <option value="core">Core</option>
    <option value="semantic">Semantic</option>
    <option value="component">Component</option>
  </select>
</div>

<div id="tokens"></div>

<script>
fetch('./tokens.json')
.then(res => res.json())
.then(data => {

  const container = document.getElementById('tokens');
  const searchInput = document.getElementById('search');
  const tierFilter = document.getElementById('tierFilter');

  function flatten(obj, prefix = '', tier = null) {
    return Object.entries(obj).reduce((acc, [key, value]) => {
      const newKey = prefix ? prefix + '.' + key : key;

      // Detect tier at top level
      if (!tier && (key === 'core' || key === 'semantic' || key === 'component')) {
        Object.assign(acc, flatten(value, key, key));
      } 
      else if (typeof value === 'object' && value.value === undefined) {
        Object.assign(acc, flatten(value, newKey, tier));
      } 
      else {
        acc[newKey] = {
          value: value.value || value,
          tier: tier
        };
      }

      return acc;
    }, {});
  }

  const flat = flatten(data);

  function resolveAlias(name, chain = []) {
    const token = flat[name];
    if (!token) return chain;

    const value = token.value;

    if (typeof value === 'string' && value.startsWith('{')) {
      const clean = value.replace(/[{}]/g, '');
      chain.push(clean);
      return resolveAlias(clean, chain);
    }

    return chain;
  }

  function render() {
    container.innerHTML = '';

    const search = searchInput.value.toLowerCase();
    const tier = tierFilter.value;

    Object.entries(flat).forEach(([name, token]) => {

      if (tier !== 'all' && token.tier !== tier) return;
      if (!name.toLowerCase().includes(search)) return;

      const value = token.value;
      const aliasChain = resolveAlias(name);

      let resolvedValue = value;
      if (aliasChain.length) {
        const final = flat[aliasChain[aliasChain.length - 1]];
        if (final) resolvedValue = final.value;
      }

      const div = document.createElement('div');
      div.className = 'token';

      const isColor = /^#|rgb|hsl/.test(resolvedValue);
      const isFontSize = name.includes('font') || name.includes('size');

      div.innerHTML = `
        <div class="token-name">${name}</div>
        <div class="token-meta">Tier: ${token.tier || 'unknown'}</div>
        
        ${isColor ? `<div class="swatch" style="background:${resolvedValue}"></div>` : ''}
        
        <div><strong>Value:</strong> ${resolvedValue}</div>
        
        ${aliasChain.length ? `
          <div class="alias-chain">
            Alias chain → ${aliasChain.join(' → ')}
          </div>` : ''}
        
        ${isFontSize ? `
          <div class="typography-preview" style="font-size:${resolvedValue}">
            The quick brown fox jumps over the lazy dog
          </div>` : ''}
      `;

      container.appendChild(div);
    });
  }

  searchInput.addEventListener('input', render);
  tierFilter.addEventListener('change', render);

  render();
});
</script>

</body>
</html>
